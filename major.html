<style>
  body {
    background-color: #333;
    /* background-color: #bbb; */
    color: white;
    /* font-family: 'Courier New', Courier, monospace; */
    font-family: Arial, Helvetica, sans-serif;
    text-align: center;
    --uno-green: rgb(11, 127, 36);
    --uno-yellow: rgb(237, 198, 55);
    --uno-red: rgb(206, 0, 17);
    --uno-blue: rgb(0, 70, 148);
  }
  .unoColours .clubs { color: lime }
  .unoColours .diamonds { color: var(--uno-yellow) }
  .unoColours .hearts { color: coral }
  .unoColours .spades { color: lightskyblue }

  #root {
    display: inline-block;
    text-align: left;
    min-width: min(800px, 80vw);
    padding-top: 80px;
    margin: auto;
  }
  [id^="grid"] {
    display: flex;
    margin-bottom: 60px;
    max-width: 80vw;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 20px;
  }
  .gridPair {
    /* flex-grow: 1; */
    display: flex;
  }
  .gridPair:last-child {
    opacity: 0
  }

  #unoCheckbox, [for="unoCheckbox"] { display: none }
  .showSuits *:is(#unoCheckbox, [for="unoCheckbox"]) { display: initial }
</style>
<body onload="suitsCheckbox.click()">
  <div id="root">
    <div id="grid1"></div>
    <div id="grid2"></div>
    <div id="controls">
      <input id="suitsCheckbox" type="checkbox" onchange="body.classList[this.checked ? 'add' : 'remove']('showSuits')">
      <label for="suitsCheckbox">Show card suits</label>
      <input id="unoCheckbox" type="checkbox" onchange="body.classList[this.checked ? 'add' : 'remove']('unoColours')">
      <label for="unoCheckbox">Uno colours</label>
    </div>
    <pre id="pre"></pre>
  </div>
</body>

<script type="module">
  const HTML = (strings, ...args) => {
    const str = args.map((arg, i) => strings[i] + arg).concat(strings[args.length]).join("")
    const parser = new DOMParser()
    const doc = parser.parseFromString(str, "text/html")
    const node = doc.body.firstChild
    return node
  }
  // https://directus.example.com/items/articles?fields=id,title,author.first_name&filter[author][first_name][_eq]=Robert
  const query = `http://localhost:8055/items/major_names?
    filter[in_use][_eq]=true
    fields[]=in_use
    fields[]=major_code
    fields[]=major_name
    fields[]=character.name
    fields[]=character.sources.sources_id.name
    fields[]=character.strength
    fields[]=id
    sort[]=major_code
  `.replace(/\s+/g, "&")

  const response = await fetch(query)  
  const json = await response.json()
  const names = json.data
  const inUse = names.filter(name => name.in_use)
  // pre.innerHTML = JSON.stringify(inUse, null, 2)

  const suits = ["♧", "♢", "♡", "♤"];
  const suitClasses = ["clubs", "diamonds", "hearts", "spades"];
  // const suits = ["♣️", "♦️", "♥️", "♠️"];

  for (let i = 0; i < 12; i++) {
    const column = HTML`<div class="column"></div>`;
    // const grid = i < 4 ? grid1 : grid2
    const grid = grid1
    if (i % 2 === 0) grid.appendChild(HTML`<div class="gridPair"></div>`);
    grid.children[Math.floor(i/2)].appendChild(column)
    for (let j = 0; j < 10; j++) {
      const int = (i * 10 + j) + 1
      let digits = String(int)
      if (digits === "100") digits = "00"
      if (digits.length === 1) digits = "0" + digits
      const name = inUse.find(name => name.major_code === digits);
      const number = int % 20
      const suit = Math.floor(int / 20)
      const suitSymbol = number >= 1 && number <= 13 ? suits[suit] : null
      const missing = name?.major_name ? "" : "missing";
      const mnemonicStrength = name?.character.strength ?? ""

      column.appendChild(HTML`
        <span class="cell ${suitSymbol ? "card" : "notcard"} ${missing} strength${mnemonicStrength}">
          <span class="suitsymbol ${suitClasses[suit]}">${suitSymbol ?? " "}</span>
           <b>${digits}</b>: ${name?.major_name ?? "?"}
        </span>
      `)
    }
  }
</script>

<style>
  .column {
    display: flex;
    flex-direction: column;
  }
  .showSuits .column:nth-child(2n) {
    margin-right: 50px;
  }
  .cell {
    padding: 8px 12px 0px;
    height: 1.25rem;
    width: 130px;
  }
  .card {
    color: white;
  }
  .suitsymbol {
    display: none;
  }
  .showSuits .suitsymbol {
    display: inline-block;
    text-align: center;
    width: 20px;
    font-family: initial;
  }
  
  .missing, .showSuits .notcard {
    color: lightcoral;
    color: coral;
    color: #888
  }
  .strength5 {
    color: rgb(238, 255, 238)
  }
  .strength3 {
    color: #ddd
  }
  .strength2 {
    color: #bbb
  }
  .strength2 {
    color: #999
  }
</style>